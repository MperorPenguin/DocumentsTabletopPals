:root{
  --bg:#0f1115; --panel:#141824; --muted:#aab3c5; --ink:#e9ecf1; --border:#23283a; --hover:#1a2030;
  --yellow:#FFD166; --teal:#14B8A6; --red:#EF4444; --blue:#60A5FA; --purple:#A78BFA;
  --accent: var(--purple);
}

/* Base */
*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0; background:var(--bg); color:var(--ink);
  font:15px/1.5 system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}
.hidden{ display:none }
h1,h2,h3{ margin:0 0 8px }
.small{ font-size:12px; color:var(--muted) }

/* Top bar / nav */
.top{ position:sticky; top:0; z-index:50; backdrop-filter:blur(8px); background:#0f1115cc; border-bottom:1px solid var(--border) }
.top .inner{ max-width:1280px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; height:56px; padding:0 16px }
.logo{ display:flex; gap:8px; align-items:center }
.mark{ width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg, var(--purple), var(--yellow)) }

.nav{ display:flex; gap:8px; overflow:auto; -ms-overflow-style:none; scrollbar-width:none; }
.nav::-webkit-scrollbar{ display:none; }
.nav button{
  appearance:none; background:none; border:1px solid transparent; color:#c8cfdd;
  padding:8px 10px; border-radius:8px; cursor:pointer; transition:all .15s;
}
.nav button:hover{ background:var(--hover); color:#fff; border-color:var(--accent) }
.nav button.active{
  background:color-mix(in srgb, var(--accent) 20%, transparent);
  border-color:var(--accent); color:#fff;
  box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 35%, transparent) inset;
}

main{ max-width:1280px; margin:0 auto; padding:16px }

/* Panels & tiles */
.panel{
  background:var(--panel); border:1px solid var(--border);
  border-radius:12px; padding:14px; margin-top:12px;
}
.panel.tile{
  cursor:pointer;
  transition: transform .15s, box-shadow .15s, border-color .15s, background-color .15s;
  outline: none;
}

/* Home grid 2x2 (mobile-first) */
.home-grid{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; }
@media (max-width: 640px){
  .home-grid{ grid-template-columns: 1fr; }
}

/* Buttons */
.btn{
  appearance:none; background:var(--hover); border:1px solid var(--border);
  color:#e6e9f2; padding:8px 12px; border-radius:10px; cursor:pointer; transition:.15s;
}
.btn:hover{ filter:brightness(1.08); border-color:var(--accent) }
.btn.tiny{ padding:4px 8px; font-size:11px; }
.btn-xl{ padding:10px 16px; border-radius:12px; font-size:16px; }

/* World controls (Fullscreen / Cast) */
.control-row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
.board-ctrl{
  display:inline-flex; align-items:center; gap:6px;
  padding:8px 10px; border-radius:12px;
  background:#0f1115; border:1px solid var(--border); color:#e6e9f2;
  cursor:pointer; transition:.15s; font-size:14px;
}
.board-ctrl:hover{
  border-color:var(--accent);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 30%, transparent) inset;
}

/* Shared pill/button look (env + map selectors) */
.pill,
.map-pill,
.env-pill{
  appearance:none; background:#0f1115; border:1px solid var(--border); color:#e6e9f2;
  padding:8px 12px; border-radius:12px; cursor:pointer; transition:.15s; font-size:14px;
}
.pill:hover,
.map-pill:hover,
.env-pill:hover{
  border-color: var(--accent);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 26%, transparent) inset;
}
.pill.active,
.map-pill.active,
.env-pill.active{
  background: color-mix(in srgb, var(--accent) 18%, transparent);
  border-color: var(--accent);
  color:#fff;
}
.env-grid, .map-list{ display:flex; gap:8px; flex-wrap:wrap; }

/* World Map viewer — scale to image */
.world-stage{
  position:relative;
  border:1px solid var(--border);
  border-radius:12px;
  background:#0b1020;
  margin-inline:auto;
  display:grid;
  place-items:center;
  overflow:hidden;
  max-width:100%;
}
/* Apply scaling both with and without .world-stage wrapper */
.world-stage .world-img,
.world-img{
  display:block;
  width:auto;
  height:auto;
  max-width:min(100%, 1280px);
  max-height:85vh;
  object-fit:contain;
  background:#0b1020;
}

/* DM page */
.dm-page{
  background:var(--panel); border:1px solid var(--border);
  border-radius:14px; padding:10px;
}
.dm-head{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:6px; border-bottom:1px solid var(--border); padding-bottom:6px;
}
.dm-tabs{ display:flex; gap:6px; margin:6px 0 8px 0; }
.dm-tab{
  flex:1; text-align:center; padding:8px 10px; border-radius:999px; border:1px solid var(--border);
  background:#0f1115; color:#cbd5e1; cursor:pointer; transition:.15s; font-weight:700;
}
.dm-tab:hover{ border-color:var(--accent) }
.dm-tab.active{
  background:color-mix(in srgb, var(--accent) 18%, transparent);
  border-color:var(--accent); color:#fff;
}

.dm-section{
  margin-top:10px; background:#0f1115; border:1px solid var(--border);
  border-radius:12px; padding:10px;
}
.dm-grid3{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; align-items:stretch; grid-auto-rows:1fr; }

.dm-character-box{
  display:flex; flex-direction:column; gap:10px;
  background:#1e293b; border:1px solid #233044; border-radius:14px; padding:10px;
  box-shadow:0 2px 8px rgba(0,0,0,.35);
  transition:.15s border-color,.15s transform,.15s box-shadow;
  min-width:0; overflow:hidden;
}
.dm-character-box:hover{
  border-color:var(--accent);
  transform:translateY(-1px);
  box-shadow:0 8px 22px rgba(0,0,0,.45),
             0 0 0 2px color-mix(in srgb, var(--accent) 20%, transparent) inset;
}

.dm-card{
  background:#0f1422; border:1px solid var(--border);
  border-radius:10px; padding:10px 8px;
  display:flex; flex-direction:column; align-items:center; text-align:center; gap:8px; cursor:pointer;
}
.dm-card.selected{ border-color:var(--accent); background: color-mix(in srgb, var(--accent) 14%, #0f1422); }
.dm-card .name{ font-weight:800; font-size:12.5px; }
.dm-card .avatar{
  width:52px; height:52px; border-radius:10px; border:1px solid var(--border);
  background:#0b1020; display:flex; align-items:center; justify-content:center; overflow:hidden;
}
.dm-card .avatar img{ width:40px; height:40px; object-fit:contain; }

.badges{ display:flex; gap:6px; flex-wrap:wrap; justify-content:center }
.badge{
  font-size:10.5px; padding:3px 8px; border-radius:999px;
  border:1px solid var(--border); background:#0f1115; color:#dbe1ee;
}

.dm-title-btn{
  appearance:none; display:inline-flex; align-items:center; gap:8px; border-radius:999px; border:1px solid var(--border);
  padding:8px 12px; font-size:12px; font-weight:800; cursor:pointer; user-select:none; transition:.15s;
  width:auto; justify-content:center; text-align:center; background:var(--panel); color:var(--ink);
}
.dm-title-btn:hover{ background:color-mix(in srgb, var(--accent) 20%, var(--panel)); }
.dm-title-btn.short{ display:inline-flex; align-items:center; justify-content:center; padding:6px; min-width:34px; height:34px; line-height:1; }
.dm-title-btn.big{ padding:14px 16px; font-size:16px; border-radius:12px; }
.dm-title-btn.adv{ background:#065f46; color:#d1fae5; border-color:#0b7a5b }
.dm-title-btn.dis{ background:#7f1d1d; color:#fee2e2; border-color:#9b2222 }
.dm-character-box > .dm-actions{ display:flex; gap:6px; margin-top:6px; justify-content:center; align-items:center; }

/* Quick dice inside DM tools */
.quick-dice-row{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px }
.quick-die-btn{
  display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px;
  background:#132034; border:1px solid var(--border); cursor:pointer; color:#dbe1ee; transition:.15s; user-select:none;
  font-size:14px;
}
.quick-die-btn:hover{
  border-color: var(--accent);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 25%, transparent) inset;
}

/* Notes textarea (app + DM) */
#app-notes, #dm-notes, .dm-section textarea{
  background:#111623 !important; color:#dbe1ee !important;
  border:1px solid var(--border); border-radius:8px;
}

/* Dice styles */
.dice-row{ display:flex; gap:8px; flex-wrap:wrap }
.die-btn{
  display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px;
  background:#0f1115; border:1px solid var(--border); color:#e6e9f2; cursor:pointer; transition:.15s; font-size:14px; font-weight:600;
}
.die-btn:hover{
  border-color:var(--accent);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 26%, transparent) inset;
}
.die-icon{ font-weight:800; opacity:.9 }

.roll-output{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
.dice-hero{
  width:72px; height:72px; display:grid; place-items:center; color:var(--accent);
  filter: drop-shadow(0 8px 20px rgba(0,0,0,.35));
}
.dice-hero svg{ width:56px; height:56px; stroke-linecap:round; stroke-dasharray:6 10; }
.dice-hero.rolling svg{ animation:spin .8s linear infinite; }
.roll-total.rolling{ animation:pulse .25s ease-in-out infinite alternate; }
@keyframes pulse{ from{ transform:translateZ(0) scale(1); } to{ transform:translateZ(0) scale(1.05); } }

.roll-card{
  background:linear-gradient(180deg, #101628, #0d1222);
  border:1px solid var(--border); border-radius:12px;
  padding:12px 14px; min-width:190px;
  box-shadow:0 8px 28px rgba(0,0,0,.45);
}
.roll-total{ font-size:26px; font-weight:900; letter-spacing:.2px }
.roll-breakdown{ font-size:13px; color:#cbd5e1; margin-top:4px }

.dice-hero svg.spin{ animation:spin 0.9s cubic-bezier(.2,.8,.2,1) }
@keyframes spin{ from{transform:rotate(0)} to{transform:rotate(360deg)} }

/* Keep the die spin fully inside its 72×72 hero */
.dice-hero{
  overflow: hidden;              /* NEW: clip spinning edges/shadows */
}

/* Keep the total/breakdown animation inside the roll card */
.roll-card{
  position: relative;            /* NEW: create a containing block */
  overflow: hidden;              /* NEW: clip scaled total text */
  contain: layout paint;         /* NEW: isolate transforms for safety */
}

/* Center + confine the total while it pulses */
.roll-total{
  display: flex;                 /* NEW */
  align-items: center;           /* NEW */
  justify-content: center;       /* NEW */
  line-height: 1;                /* NEW: tighter line box */
  transform-origin: center;      /* NEW: scale from center */
  white-space: nowrap;           /* NEW: avoid wrapping overflow */
  will-change: transform;        /* NEW: smoother pulse */
}

/* Optional: slightly reduce pulse to stay extra safe (keep if needed) */
/* .roll-total.rolling{ animation: pulseTotal .25s ease-in-out infinite alternate; }
@keyframes pulseTotal{ from{ transform:scale(1) } to{ transform:scale(1.04) } } */

/* Toast */
.dm-toast{
  position: fixed; top: 14px; right: 14px; z-index: 1000;
  background: #12192a; border:1px solid var(--border); color:#e6e9f2;
  border-radius: 12px; padding: 10px 12px; min-width: 180px;
  box-shadow: 0 8px 24px rgba(0,0,0,.42);
}
.dm-toast h4{ margin:0 0 4px; font-size:13px; font-weight:800 }
.dm-toast .close{
  position:absolute; top:8px; right:10px; cursor:pointer; opacity:.7;
  line-height:1; font-weight:900; user-select:none;
}
.dm-toast .close:hover{ opacity:1 }
.dm-toast .close:focus-visible{
  outline:2px solid var(--accent); outline-offset:2px; border-radius:4px;
}

/* Section heads (light spacing) */
.section-head h2{ margin:0 0 6px; }

/* Accessibility focus rings */
:where(.btn,.board-ctrl,.pill,.map-pill,.env-pill,.die-btn,.dm-tab,.dm-title-btn):focus-visible{
  outline:2px solid var(--accent);
  outline-offset:2px;
}

/* Smooth view entry */
.view-anim{
  animation: fadeSlideIn .24s ease both;
}
@keyframes fadeSlideIn{
  from{ opacity:0; transform: translateY(6px); }
  to  { opacity:1; transform: translateY(0); }
}

/* Individual hover accents for home tiles */
.tile-home-dice:hover, .tile-home-dice:focus-visible{
  border-color: var(--yellow);
  box-shadow: 0 8px 28px rgba(0,0,0,.45),
              0 0 0 2px color-mix(in srgb, var(--yellow) 35%, transparent) inset;
  transform: translateY(-2px);
  background: color-mix(in srgb, var(--yellow) 12%, var(--panel));
}
.tile-home-notes:hover, .tile-home-notes:focus-visible{
  border-color: var(--teal);
  box-shadow: 0 8px 28px rgba(0,0,0,.45),
              0 0 0 2px color-mix(in srgb, var(--teal) 35%, transparent) inset;
  transform: translateY(-2px);
  background: color-mix(in srgb, var(--teal) 12%, var(--panel));
}
.tile-home-dm:hover, .tile-home-dm:focus-visible{
  border-color: var(--red);
  box-shadow: 0 8px 28px rgba(0,0,0,.45),
              0 0 0 2px color-mix(in srgb, var(--red) 35%, transparent) inset;
  transform: translateY(-2px);
  background: color-mix(in srgb, var(--red) 12%, var(--panel));
}
.tile-home-world:hover, .tile-home-world:focus-visible{
  border-color: var(--blue);
  box-shadow: 0 8px 28px rgba(0,0,0,.45),
              0 0 0 2px color-mix(in srgb, var(--blue) 35%, transparent) inset;
  transform: translateY(-2px);
  background: color-mix(in srgb, var(--blue) 12%, var(--panel));
}

/* Responsive tweaks */
@media (max-width: 900px){
  .dm-grid3{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}
@media (max-width: 520px){
  .dm-grid3{ grid-template-columns: 1fr; }
}


/* ==== Dice IMG support (external SVG via <img>) ==== */
.dice-hero .die-graphic{
  width:56px; height:56px;
  display:block;
  transform-style: preserve-3d;
  will-change: transform, filter;
  object-fit: contain;
}
.dice-hero.rolling .die-graphic{
  animation: diceRoll3D .8s linear infinite;
  filter: drop-shadow(0 10px 26px rgba(0,0,0,.45));
}
.dice-hero.settle .die-graphic{
  animation: diceSettle .45s cubic-bezier(.2,.9,.2,1) both;
}
