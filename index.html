<!-- DMToolkit v2.3.0 | index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>DM Toolkit</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Top bar -->
  <div class="top">
    <div class="inner">
      <div class="logo">
        <div class="mark"></div>
        <strong>DM Toolkit</strong>
      </div>
      <div class="nav">
        <button id="nav-home"   onclick="nav('home')">Home</button>
        <button id="nav-board"  onclick="nav('board')">Board</button>
        <button id="nav-dice"   onclick="nav('dice')">Dice</button>
        <button id="nav-notes"  onclick="nav('notes')">Notes</button>
      </div>
    </div>
  </div>

  <main>
    <!-- HOME -->
    <section id="view-home">
      <div class="panel tile tile-home-board" tabindex="0" onclick="nav('board')">
        <h2>Battle Board</h2>
        <div class="small">26Ã—26 grid, tokens, fullscreen &amp; pop-out. Maps from <code>assets/maps/index.json</code> (PNG/SVG).</div>
      </div>
      <div class="panel tile tile-home-dice" tabindex="0" onclick="nav('dice')">
        <h2>Dice</h2>
        <div class="small">Quick multi-die rolling.</div>
      </div>
      <div class="panel tile tile-home-notes" tabindex="0" onclick="nav('notes')">
        <h2>Notes</h2>
        <div class="small">Session / campaign notes.</div>
      </div>
    </section>

    <!-- BOARD -->
    <section id="view-board" class="hidden">
      <h2>Board</h2>

      <!-- controls ABOVE the map (only Full + Pop-out) -->
      <div class="board-control-wrap">
        <div id="board-controls" class="board-control-bar">
          <button class="board-ctrl" onclick="toggleBoardFullscreen()">Full</button>
          <button class="board-ctrl" onclick="openBoardViewer()">Pop-out</button>
        </div>
      </div>

      <div id="board" class="board" style="margin-top:10px" onclick="boardClick(event)"></div>

      <div class="small" style="margin-top:8px">
        Tip: Click a token to select it, then click a grid cell to move. Press <b>Shift+D</b> to toggle the DM Panel.
      </div>
    </section>

    <!-- DICE -->
    <section id="view-dice" class="hidden">
      <h2>Dice</h2>
      <div class="panel">
        <div id="dice-buttons" class="dice-row"></div>
        <div style="margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <div id="dice-selection" class="small">No dice selected</div>
          <button class="btn btn-xl" onclick="rollAll()">Roll</button>
          <button class="btn btn-xl" onclick="clearDice()">Clear</button>
        </div>
        <div id="dice-output" class="roll-output" style="margin-top:12px"></div>
      </div>
    </section>

    <!-- NOTES -->
    <section id="view-notes" class="hidden">
      <h2>Notes</h2>
      <div class="panel">
        <textarea id="notes" rows="12" style="width:100%"></textarea>
      </div>
    </section>
  </main>

  <footer>
    <div class="small">Local, offline-friendly DM toolkit. Maps loaded from <code>assets/maps/index.json</code> (PNG/SVG).</div>
  </footer>

  <!-- DM Panel -->
  <div id="dm-panel" class="dm-panel hidden"></div>

  <!-- DM FAB -->
  <button id="dm-fab" class="dm-fab" onclick="maximizeDmPanel()">
    <span class="dm-fab-dot"></span>
    <span class="dm-fab-label">DM Panel</span>
    <span id="dm-fab-count" class="dm-fab-count">0</span>
  </button>

    <!-- Rescue nav: works even if app.js fails to load -->
  <script>
    (function(){
      function navRescue(route){
        var views = ['home','board','dice','notes'];
        for (var i=0;i<views.length;i++){
          var v = views[i];
          var main = document.getElementById('view-'+v);
          var btn  = document.getElementById('nav-'+v);
          if(!main || !btn) continue;
          if(v===route){ main.classList.remove('hidden'); btn.classList.add('active'); }
          else{ main.classList.add('hidden'); btn.classList.remove('active'); }
        }
      }
      // If app.js hasn't defined nav yet, use the rescue one.
      window.nav = window.nav || navRescue;
    })();
  </script>

  <!-- Load the main app (classic script, NOT type="module") -->
  <script src="app.js"></script>

  <!-- After app.js loads, apply any early clicks (and log status) -->
  <script>
    console.log('[boot] app.js loaded?', !!window.renderBoard);
    if (window.__pendingNav && typeof window.nav === 'function') {
      window.nav(window.__pendingNav);
      window.__pendingNav = null;
    }
  </script>
</body>
</html>
