<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>DM Toolkit — DocumentsTabletopPals</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts: Arvo (preconnect + stylesheet) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Arvo:wght@400;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="site-head">
    <a class="brand" href="#home" data-nav="home" aria-label="Go to Home">
      <img src="./assets/logo.svg" alt="" class="brand-mark" onerror="this.style.display='none'">
      <span class="brand-title">DM Toolkit</span>
    </a>

    <!-- Burger -->
    <button class="burger" id="burger" aria-label="Open menu" aria-expanded="false" aria-controls="topnav">
      <span class="burger-bars" aria-hidden="true"></span>
    </button>

    <!-- Top Nav -->
    <nav id="topnav" class="topnav" role="navigation">
      <button class="btn ghost navbtn" data-nav="home" aria-controls="section-home" aria-current="page">Home</button>
      <button class="btn ghost navbtn" data-nav="world" aria-controls="section-world">World Map</button>
      <button class="btn ghost navbtn" data-nav="dice" aria-controls="section-dice">Dice</button>
      <button class="btn ghost navbtn" data-nav="notes" aria-controls="section-notes">Notes</button>
      <button class="btn ghost navbtn" data-nav="dm" aria-controls="section-dm">DM</button>
      <button class="btn ghost navbtn" data-nav="encounters" aria-controls="section-encounters">Encounter Builder</button>
      <button class="btn ghost navbtn" data-nav="logbook" aria-controls="section-logbook">Logbook</button>
      <button class="btn ghost navbtn" data-nav="characters" aria-controls="section-characters">Characters</button>
    </nav>
  </header>

  <main class="wrap main" id="main">
    <!-- HOME -->
    <section id="section-home" class="tabpanel" role="tabpanel" aria-labelledby="home" data-tab="home">
      <div class="tiles grid cols-2 cols-3@lg">
        <button class="tile card" data-nav="world">
          <div class="tile-head">
            <span class="tile-icon" aria-hidden="true">🗺️</span>
            <h2>World Map</h2>
          </div>
          <p>Browse maps, toggle Fit/Actual, cast/pop-out.</p>
        </button>

        <button class="tile card" data-nav="dice">
          <div class="tile-head">
            <span class="tile-icon" aria-hidden="true">🎲</span>
            <h2>Dice</h2>
          </div>
          <p>Build pools (d4 to d20), roll, animate, and clear.</p>
        </button>

        <button class="tile card" data-nav="dm">
          <div class="tile-head">
            <span class="tile-icon" aria-hidden="true">🧭</span>
            <h2>DM Tools</h2>
          </div>
          <p>Party sync, backups, and utilities for quick prep.</p>
        </button>

        <button class="tile card" data-nav="encounters">
          <div class="tile-head">
            <span class="tile-icon" aria-hidden="true">⚔️</span>
            <h2>Encounter Builder</h2>
          </div>
          <p>Open the encounter calculators & builders.</p>
        </button>

        <button class="tile card" data-nav="notes">
          <div class="tile-head">
            <span class="tile-icon" aria-hidden="true">📝</span>
            <h2>Notes</h2>
          </div>
          <p>Quick notes with autosave to your device.</p>
        </button>

        <button class="tile card" data-nav="logbook">
          <div class="tile-head">
            <span class="tile-icon" aria-hidden="true">📓</span>
            <h2>Logbook</h2>
          </div>
          <p>Standalone logbook, mounted inside the toolkit.</p>
        </button>

        <button class="tile card" data-nav="characters">
          <div class="tile-head">
            <span class="tile-icon" aria-hidden="true">👤</span>
            <h2>Characters</h2>
          </div>
          <p>Create, edit, print, and add members to Party.</p>
        </button>
      </div>
    </section>

    <!-- WORLD MAP -->
    <section id="section-world" class="tabpanel" role="tabpanel" data-tab="world" hidden>
      <header class="section-head">
        <h2>World Map</h2>
        <div class="actions">
          <button id="btn-world-fit" class="btn ghost" type="button" title="Toggle Fit / Actual">Fit / Actual</button>
          <button id="btn-world-full" class="btn ghost" type="button">Fullscreen</button>
          <button id="btn-world-pop" class="btn ghost" type="button">Cast / Pop-out</button>
        </div>
      </header>

      <div class="world grid cols-4@lg">
        <aside class="card world-list">
          <h3 class="small">Select Map</h3>
          <ul id="map-list" class="map-list" role="listbox" aria-label="Available maps"></ul>
        </aside>

        <figure class="card world-viewer">
          <img id="world-img" alt="Selected map" draggable="false">
          <figcaption id="world-caption" class="tiny muted"></figcaption>
        </figure>
      </div>
    </section>

    <!-- DICE -->
    <section id="section-dice" class="tabpanel" role="tabpanel" data-tab="dice" hidden>
      <header class="section-head">
        <h2>Dice</h2>
      </header>

      <div class="dice card">
        <div class="dicebar">
          <button class="btn ghost die" data-d="4"  type="button">d4</button>
          <button class="btn ghost die" data-d="6"  type="button">d6</button>
          <button class="btn ghost die" data-d="8"  type="button">d8</button>
          <button class="btn ghost die" data-d="10" type="button">d10</button>
          <button class="btn ghost die" data-d="12" type="button">d12</button>
          <button class="btn ghost die" data-d="20" type="button">d20</button>
        </div>

        <div class="dicepool" id="dicepool" aria-live="polite">Add dice to roll…</div>

        <div class="actions">
          <button id="btn-roll" class="btn" type="button">Roll</button>
          <button id="btn-clear" class="btn ghost" type="button">Clear</button>
        </div>

        <output id="dice-result" class="dice-result" aria-live="polite"></output>
      </div>
    </section>

    <!-- NOTES -->
    <section id="section-notes" class="tabpanel" role="tabpanel" data-tab="notes" hidden>
      <header class="section-head">
        <h2>Notes</h2>
      </header>
      <div class="card">
        <textarea id="notes" rows="12" placeholder="Type notes…"></textarea>
      </div>
    </section>

    <!-- DM -->
    <section id="section-dm" class="tabpanel" role="tabpanel" data-tab="dm" hidden>
      <header class="section-head">
        <h2>DM Tools</h2>
      </header>

      <div class="grid cols-2">
        <section class="card">
          <h3>Party (read-only preview)</h3>
          <div id="party" class="party">No party members yet.</div>
          <p class="tiny muted">Party syncs automatically from Characters (shared key: <code>tp_cc_characters</code>).</p>
        </section>

        <section class="card">
          <h3>Backup / Restore</h3>
          <p>Back up or restore your device-local data (settings, notes, and characters).</p>
          <div class="backup-row">
            <button id="btn-export" class="btn" type="button">Export data</button>
            <label class="file btn ghost">
              <input id="file-import" type="file" accept="application/json" />
              Import data…
            </label>
            <button id="btn-reset" class="btn ghost" type="button">Reset all</button>
          </div>
          <p class="tiny muted">Exports include <code>tp_state_v26</code> and <code>tp_cc_characters</code>.</p>
        </section>
      </div>
    </section>

    <!-- ENCOUNTER BUILDER -->
    <section id="section-encounters" class="tabpanel" role="tabpanel" data-tab="encounters" hidden>
      <header class="section-head">
        <h2>Encounter Builder</h2>
      </header>

      <div class="card">
        <p>Open the encounter builder in its folder:</p>
        <p><a class="btn" href="./encounters/" rel="noopener">Open Encounter Builder</a></p>
        <p class="tiny muted">We’ve updated the path from <code>./encounters/encounters/</code> → <code>./encounters/</code>.</p>
      </div>
    </section>

    <!-- LOGBOOK -->
    <section id="section-logbook" class="tabpanel" role="tabpanel" data-tab="logbook" hidden>
      <header class="section-head">
        <h2>Logbook</h2>
      </header>

      <div class="card">
        <iframe id="logbook-frame" src="./logbook/index.html" title="Logbook" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        <p class="tiny muted">If this doesn’t load, make sure <code>/logbook/index.html</code> exists.</p>
      </div>
    </section>

    <!-- CHARACTERS -->
    <section id="section-characters" class="tabpanel" role="tabpanel" data-tab="characters" hidden>
      <header class="section-head">
        <h2>Character Manager</h2>
      </header>

      <div class="card">
        <iframe id="characters-frame" src="./dnd-characters-modules/index.html" title="Character Manager" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        <p class="tiny muted">Shares party with DM tab via <code>localStorage</code> key <code>tp_cc_characters</code>.</p>
      </div>
    </section>
  </main>

  <footer class="site-foot">
    <p class="tiny muted">© TabletopPals — DM Toolkit</p>
  </footer>

  <script src="./app.js" type="module"></script>
</body>
</html>
